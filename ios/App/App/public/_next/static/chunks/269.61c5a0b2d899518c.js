"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[269],{269:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var o=n(5155),s=n(8255),i=n(3704),a=n(1038),r=n(9540),l=n(7195),c=n(2036),d=n(6721),m=n(5752),p=n.n(m),x=n(2115);function g(e){let{markers:t}=e,n=(0,s.ko)(),[o,i]=(0,x.useState)(!1);return(0,x.useEffect)(()=>{!o&&t.length>0?(console.log("\uD83C\uDFAF Initial map setup with first marker:",t[0].position),n.setView(t[0].position,12),i(!0)):o||0!==t.length||(console.log("\uD83C\uDFAF Initial map setup - centering on Mindoro"),n.setView([13,121.2],10),i(!0))},[n,t.length,o]),null}function u(e){let{onZoomChange:t}=e,n=(0,s.ko)();return(0,x.useEffect)(()=>{let e=()=>{t(n.getZoom())};return e(),n.on("zoomend",e),()=>{n.off("zoomend",e)}},[n,t]),null}function h(e){let{markers:t}=e,n=(0,s.ko)(),o=()=>{if(0!==t.length)if(1===t.length)n.setView(t[0].position,14);else{let e=p().featureGroup(t.map(e=>p().marker(e.position)));n.fitBounds(e.getBounds().pad(.1))}};return(0,x.useEffect)(()=>{let e=p().control.scale({position:"bottomleft",metric:!0,imperial:!1}).addTo(n),t=new(p().Control.extend({onAdd:function(){let e=p().DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-custom");return e.innerHTML='\n          <button id="go-to-live" style="\n            background: white;\n            border: none;\n            width: 40px;\n            height: 40px;\n            cursor: pointer;\n            font-size: 16px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            box-shadow: 0 1px 5px rgba(0,0,0,0.65);\n          " title="Go to Live Locations">\n            \uD83C\uDFAF\n          </button>\n        ',e.onclick=o,e}}))({position:"topright"});return t.addTo(n),()=>{n.removeControl(e),n.removeControl(t)}},[n,t]),null}n(8413),delete p().Icon.Default.prototype._getIconUrl,p().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});let f=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,o=n<=10?{size:24,fontSize:14,badge:6,ripple:8}:n<=13?{size:32,fontSize:16,badge:7,ripple:10}:n<=16?{size:40,fontSize:20,badge:8,ripple:12}:{size:48,fontSize:24,badge:10,ripple:14},s=Math.max(2,Math.floor(o.size/12));return p().divIcon({html:'\n      <div style="\n        width: '.concat(o.size,"px;\n        height: ").concat(o.size,"px;\n        background-color: ").concat(e?"#DCFCE7":"#F3F4F6",";\n        border: ").concat(s,"px solid ").concat(e?"#10B981":"#6B7280",";\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: ").concat(o.fontSize,"px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n        position: relative;\n        transition: all 0.2s ease-in-out;\n        ").concat(t?"animation: bounce 1s ease-in-out 3;":"",'\n      ">\n        \uD83D\uDC6E‍♂️\n        <div style="\n          position: absolute;\n          top: -2px;\n          right: -2px;\n          width: ').concat(o.badge,"px;\n          height: ").concat(o.badge,"px;\n          background-color: ").concat(t?"#EF4444":e?"#059669":"#9CA3AF",";\n          border-radius: 50%;\n          border: 1px solid white;\n          ").concat(e||t?"animation: pulse 2s infinite;":"",'\n        "></div>\n        ').concat(t?'\n          <div style="\n            position: absolute;\n            top: -4px;\n            right: -4px;\n            width: '.concat(o.ripple,"px;\n            height: ").concat(o.ripple,'px;\n            background-color: rgba(239, 68, 68, 0.3);\n            border-radius: 50%;\n            animation: ripple 2s infinite;\n          "></div>\n        '):"","\n      </div>\n      <style>\n        @keyframes pulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.5; }\n        }\n        @keyframes bounce {\n          0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }\n          40%, 43% { transform: translate3d(0,-8px,0); }\n          70% { transform: translate3d(0,-4px,0); }\n          90% { transform: translate3d(0,-2px,0); }\n        }\n        @keyframes ripple {\n          0% { transform: scale(0.8); opacity: 1; }\n          100% { transform: scale(2.5); opacity: 0; }\n        }\n      </style>\n    "),className:"police-marker",iconSize:[o.size,o.size],iconAnchor:[o.size/2,o.size/2],popupAnchor:[0,-o.size/2]})};function b(e){let{markers:t}=e,[n,s]=(0,x.useState)("connecting"),[m,b]=(0,x.useState)(12);(0,x.useEffect)(()=>{if(t.length>0){s("connected");let e=setTimeout(()=>{s("connecting")},3e4);return()=>clearTimeout(e)}},[t]),(0,x.useEffect)(()=>{console.log("\uD83D\uDDFA️ RealtimeMapClient received markers:",t.length)},[t]);let y=t.length>0?t[0].position:[13,121.2],j=(()=>{if(0===t.length)return console.log("No markers, using Mindoro bounds"),p().latLngBounds([12.2,120.8],[13.8,121.6]);console.log("Calculating bounds for",t.length,"markers");let e=p().latLngBounds(t.map(e=>(console.log("Marker position:",e.position),e.position))),n=p().latLngBounds([12.2,120.8],[13.8,121.6]),o=e.extend(n);return console.log("Combined bounds with Mindoro:",o),o})();return console.log("Map center:",y),console.log("Map bounds:",j),(0,o.jsxs)(i.W,{center:y,zoom:10,maxZoom:20,minZoom:8,style:{height:"100%",width:"100%"},zoomControl:!0,doubleClickZoom:!0,scrollWheelZoom:!0,dragging:!0,children:[(0,o.jsx)(g,{markers:t}),(0,o.jsx)(u,{onZoomChange:b}),(0,o.jsx)(h,{markers:t}),(0,o.jsx)("div",{className:"absolute top-4 right-16 z-50 bg-white bg-opacity-95 px-3 py-2 rounded-lg shadow-md border",children:(0,o.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,o.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("connected"===n?"bg-green-500 animate-pulse":"connecting"===n?"bg-yellow-500 animate-pulse":"bg-red-500")}),(0,o.jsx)("span",{className:"font-medium ".concat("connected"===n?"text-green-700":"connecting"===n?"text-yellow-700":"text-red-700"),children:"connected"===n?"Live":"connecting"===n?"Monitoring":"Disconnected"}),t.length>0&&(0,o.jsxs)("span",{className:"text-gray-600",children:["• ",t.length," user",1!==t.length?"s":""]})]})}),(0,o.jsx)("div",{className:"absolute bottom-4 right-4 z-50 bg-white bg-opacity-95 px-2 py-1 rounded shadow-md border",children:(0,o.jsxs)("div",{className:"text-xs text-gray-600",children:["Zoom: ",m]})}),(0,o.jsxs)(a.In,{position:"topleft",children:[(0,o.jsx)(a.In.BaseLayer,{checked:!0,name:"OpenStreetMap",children:(0,o.jsx)(r.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:19})}),(0,o.jsx)(a.In.BaseLayer,{name:"Satellite (Esri)",children:(0,o.jsx)(r.e,{attribution:'\xa9 <a href="https://www.esri.com/">Esri</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",maxZoom:19})}),(0,o.jsx)(a.In.BaseLayer,{name:"High-Res Satellite",children:(0,o.jsx)(r.e,{attribution:'\xa9 <a href="https://carto.com/">CARTO</a>',url:"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",subdomains:"abcd",maxZoom:20})}),(0,o.jsx)(a.In.BaseLayer,{name:"Terrain",children:(0,o.jsx)(r.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",maxZoom:17})}),(0,o.jsx)(a.In.BaseLayer,{name:"Dark Mode",children:(0,o.jsx)(r.e,{attribution:'\xa9 <a href="https://carto.com/">CARTO</a>',url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",subdomains:"abcd",maxZoom:20})})]}),t.map(e=>{var t;console.log("\uD83C\uDFAF Rendering marker:",e.id,"at position:",e.position,"is_active:",e.location.is_active);let n=e.location.is_active;return(0,o.jsxs)(l.p,{position:e.position,icon:f(n,!1,m),children:[(0,o.jsx)(c.m,{permanent:!1,direction:"top",offset:[0,-20],children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"font-semibold",children:e.user.name}),(0,o.jsx)("div",{className:"text-xs",children:n?"\uD83D\uDFE2 Online":"⚪ Offline"})]})}),(0,o.jsx)(d.z,{className:"custom-popup",closeButton:!0,maxWidth:250,children:(0,o.jsxs)("div",{className:"p-2 min-w-[200px]",children:[(0,o.jsxs)("div",{className:"border-b pb-2 mb-2",children:[(0,o.jsx)("h3",{className:"font-semibold text-lg text-gray-800",children:e.user.name}),(0,o.jsx)("p",{className:"text-sm text-gray-600",children:e.user.email})]}),e.user.phone&&(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Phone:"}),(0,o.jsx)("p",{className:"text-sm text-gray-600",children:e.user.phone})]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Location:"}),(0,o.jsxs)("p",{className:"text-xs text-gray-500",children:["Lat: ",e.position[0].toFixed(6),", Lng: ",e.position[1].toFixed(6)]})]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Accuracy:"}),(0,o.jsxs)("p",{className:"text-xs text-gray-500",children:["\xb1",(null==(t=e.location.accuracy)?void 0:t.toFixed(0))||"Unknown"," meters"]})]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Last Update:"}),(0,o.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.location.timestamp).toLocaleString()})]}),(0,o.jsx)("div",{className:"mt-3 pt-2 border-t",children:(0,o.jsxs)("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(n?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:[(0,o.jsx)("div",{className:"w-2 h-2 rounded-full mr-1 ".concat(n?"bg-green-400":"bg-gray-400")}),n?"Online":"Offline"]})})]})})]},"".concat(e.id,"-").concat(e.location.timestamp))})]})}}}]);